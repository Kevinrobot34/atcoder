# 第二回全国統一プログラミング王決定戦予選
* https://atcoder.jp/contests/nikkei2019-2-qual

## B - Counting of Trees (300点)
* `d[i] = (頂点1と頂点iの距離)`
* `cnt[i] = (距離iであるような頂点数)` とする。
* `d[1] = 0`でかつ`cnt[0] = 1`でないときは`ans = 0`
* `d[1] = 0`でかつ`cnt[0] = 1`の時
  - 距離`i`のある頂点は、距離`i-1`の頂点のどれかに繋げば良い
  - つまり`ans *= cnt[i-1]**cnt[i]`を`i=1,2,...`で行えば良い


## C - Swaps (600点)
数学的パズルゲー
* `B`についてはソート済みと思って一般性を失わない
* 置換`p`を用いて`A`を入れ替える操作をしたと考えることにする
* 次のような置換`p`が存在するかを判定する問題ということになる。
  - `A[ p[i] ] <= B[i]`
  - 置換`p`をサイクルに分解すると、それは2個以上からなる
    - `1,2,...,n`を`2,3,...,n,1`と巡回させるには`n-1`回の入れ替えが必要であるから
* 置換`p`として、`A`をソート済みにする置換`p'`をとる
  - 「任意の`i`に対して`A[ p'[i] ] <= B[i]`」とならない場合、答えはNo
  - 「任意の`i`に対して`A[ p'[i] ] <= B[i]`」となる場合
    - 「置換`p'`がサイクルに分解した時2個以上」となる場合、答えはOK
    - 「置換`p'`がサイクルに分解した時2個以上」とならない場合（サイクルが1つのみの場合）
      - 「任意の`i`に対して`B[i] < A[ p'[i+1] ]`」となる場合、答えはNo
        - `A[p'[1]] <= B[1] < A[p'[2]] <= B[2] < A[p'[3]] <= ...` となってしまうので、他の置換では「任意の`i`に対して`A[ p'[i] ] <= B[i]`」を実現できないから
      - 「任意の`i`に対して`B[i] < A[ p'[i+1] ]`」とならない場合、答えはOK
        - つまり「ある`j`に対して`B[j] > A[ p'[j+1] ]`となる場合
        - `j`と`j+1`を入れ替えれば、「任意の`i`に対して`A[ p'[i] ] <= B[i]`」を満たしたままサイクルを2つに分けられる


## D - Shortest Path on a Line (600点)
* dijkstra
  - 今回考えるのは頂点1から頂点`N`への最短経路
  - 数直線のような絵を書きながら考えると、問題文の無向グラフの代わりに次のような有向グラフを考えれば良いことがわかる
    - 各操作において、`L[i]<=s<t<=R[i]`なる任意の`s,t`について、`s`から`t`へコスト`C[i]`の有向辺を張る
    - （頂点が大きくなる方向にのみ辺を張っておく）
  - このままだと辺の数が多くなりうるが、さらに考えると次のような少ない辺で済むことがわかる
    - 各操作において、`L[i]`から`R[i]`に長さ`C[i]`の辺を張る
      - 合計`M`本
    - 2以上`N`以下の全ての`j`について、`j+1`から`j`に長さ0の辺を張る
      - 合計`N-1`本
      - これにより`L[i]<=s<t<=R[i]`なる任意の`s,t`について、`s`から`t`へコスト`C[i]`で移動できる
  - 上記のように作った有向グラフについてdijkstraをする
    - 辺の数は`M+(N-1)`本で、頂点は`N`点なので、`O((M+N)logN)`
* segment tree
  - `dp[i] = (1からiへの最短距離)`
    - 初期化
      - `dp[1] = 0`
      - `dp[i] = INF (i > 1)`
    - これを小さい方から順に決定していく
  - セグ木で、`dp[i]`のRMQを答えられるようにしておく
  - `dp[i]`まで求まってる時に`dp[i+1]`を求めたい
    - `i+1`を右端の点とするような操作区間`[l, i+1]`に注目する
      - コストは`c`とする
    - `dp[i+1] = min(dp[i+1], RMQ(l, i+1) + c)`
  - RMQが`M`回と、更新が`N`回なので、`O((M+N)logN)`
  - https://atcoder.jp/contests/nikkei2019-2-qual/submissions/8356834
